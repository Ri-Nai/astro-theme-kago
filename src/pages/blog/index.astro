---
import { getCollection } from 'astro:content';
import BlogLayout from '@theme/layouts/BlogLayout.astro';
import Navigation from '@theme/components/Navigation.astro';

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter((post: any) => !post.data.hidden)
  .sort((a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// 统计数据
const allTags = [...new Set(posts.flatMap((post: any) => post.data.tags))].filter(tag => typeof tag === 'string') as string[];
const allCategories = [...new Set(posts.map((post: any) => post.data.category).filter(Boolean))] as string[];

// 标签统计
const tagCounts: Record<string, number> = {};
allTags.forEach((tag) => {
  tagCounts[tag] = posts.filter((post: any) => post.data.tags.includes(tag)).length;
});

// 分类统计
const categoryStats = allCategories.map(category => ({
  name: category,
  count: posts.filter((post: any) => post.data.category === category).length
}));
---

<BlogLayout
  title="文章列表 - 我的博客"
  description="浏览所有博客文章，按标签和分类筛选"
  posts={posts}
  allTags={allTags}
  allCategories={allCategories}
  tagCounts={tagCounts}
  categoryStats={categoryStats}
>
  <Navigation slot="navigation" />
</BlogLayout>
